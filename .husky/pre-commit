#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ðŸš¨ EMBEDDED PROTOCOL ENFORCEMENT - PRE-COMMIT HOOK"
echo "=================================================="
echo "âš ï¸  ZERO TOLERANCE: Checking for hardcoding violations before commit"
echo "âš ï¸  This check is PERMANENTLY EMBEDDED and cannot be bypassed"
echo "âš ï¸  NOTE: --no-verify WILL NOT WORK - Server-side CI/CD enforces compliance"
echo "=================================================="

# Log enforcement trigger
echo "$(date): PRE-COMMIT enforcement triggered by user $(whoami)" >> .protocol-enforcement.log

# Run protocol compliance check
if ! ./protocol_check.sh; then
    echo ""
    echo "ðŸ›‘ COMMIT BLOCKED: Protocol violations detected"
    echo "ðŸ›‘ Fix ALL violations before attempting to commit"
    echo "ðŸ›‘ Run './protocol_check.sh' to see specific issues"
    echo "ðŸ›‘ This is a ZERO TOLERANCE policy - no exceptions allowed"
    echo "ðŸ›‘ Even with --no-verify, CI/CD will block deployment"
    echo ""
    echo "$(date): COMMIT BLOCKED - Protocol violations detected" >> .protocol-enforcement.log
    exit 1
fi

echo "âœ… Protocol compliance verified - commit allowed"
echo "$(date): COMMIT ALLOWED - Protocol compliance verified" >> .protocol-enforcement.log