#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ðŸš¨ EMBEDDED PROTOCOL ENFORCEMENT - PRE-PUSH HOOK"
echo "================================================="
echo "âš ï¸  FINAL ZERO TOLERANCE CHECK: Scanning entire codebase before push"
echo "âš ï¸  This prevents violations from reaching remote repository"
echo "âš ï¸  PERMANENTLY EMBEDDED - cannot be disabled or bypassed"
echo "âš ï¸  Server-side CI/CD provides secondary enforcement layer"
echo "================================================="

# Log enforcement trigger
echo "$(date): PRE-PUSH enforcement triggered by user $(whoami)" >> .protocol-enforcement.log

# Run comprehensive protocol compliance check
if ! ./protocol_check.sh; then
    echo ""
    echo "ðŸ›‘ PUSH BLOCKED: Critical protocol violations found"
    echo "ðŸ›‘ This prevents violations from reaching remote repository"
    echo "ðŸ›‘ Fix ALL violations immediately before attempting push"
    echo "ðŸ›‘ ZERO TOLERANCE POLICY: No hardcoding allowed anywhere"
    echo "ðŸ›‘ CI/CD will also block if you bypass this check"
    echo ""
    echo "$(date): PUSH BLOCKED - Protocol violations detected" >> .protocol-enforcement.log
    exit 1
fi

echo "âœ… Comprehensive protocol compliance verified"
echo "âœ… Push allowed - no violations detected"
echo "$(date): PUSH ALLOWED - Protocol compliance verified" >> .protocol-enforcement.log